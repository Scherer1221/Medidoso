<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda Semanal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script> <!-- Incluindo a biblioteca html2canvas -->
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
        }

        body {
            display: flex;
        }

        .menu {
            width: 200px;
            background-color: #007bff;
            color: white;
            padding: 15px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }

        .menu h2 {
            text-align: center;
        }

        .menu ul {
            list-style-type: none;
            padding: 0;
        }

        .menu li {
            margin: 10px 0;
        }

        .menu a {
            color: white;
            text-decoration: none;
            padding: 10px;
            display: block;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .menu a:hover {
            background-color: #0056b3;
        }

        .container {
            flex: 1;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        h1 {
            text-align: center;
            position: relative;
        }

        .agenda {
            display: flex;
            justify-content: space-between;
            flex-grow: 1;
            border: 1px solid #ddd; /* Caixa envolvendo todos os dias */
            border-radius: 5px;
            overflow: hidden;
        }

        .dia {
            flex: 1;
            padding: 10px;
            display: flex;
            flex-direction: column;
            background-color: #f9f9f9;
            box-sizing: border-box;
            position: relative;
            align-items: center; /* Alinha o conteúdo ao centro */
            cursor: pointer; /* Cursor para indicar que é clicável */
        }

        .dia:not(:last-child) {
            border-right: 1px solid #ddd; /* Separador vertical entre os dias */
        }

        .dia h2 {
            text-align: center;
            font-size: 19px; /* Tamanho de fonte ajustado para 19px */
            margin-bottom: 10px; /* Adicionado espaço abaixo do título */
            margin-top: 30px; /* Margem superior maior para mover os dias mais para baixo */
        }

        ul {
            list-style-type: none;
            padding: 0;
            flex-grow: 1;
            text-align: center; /* Centraliza o conteúdo da lista */
        }

        .data {
            position: absolute;
            top: 10px;
            right: 10px;
            font-weight: bold;
            background-color: #007bff;
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
        }

        /* Estilo da caixa modal */
        .modal {
            display: none; /* Inicialmente escondida */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            text-align: center;
            width: 300px; /* Largura fixa para a modal */
        }

        .close {
            cursor: pointer;
            color: #007bff;
            margin-top: 10px;
        }

        input[type="text"], input[type="time"], textarea, input[type="file"] {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .checkbox-group {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .button-container {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
        }

        .button-container button {
            margin-left: 10px; /* Espaçamento entre os botões */
        }
    </style>
</head>
<body>
    <div class="menu">
        <h2>Menu</h2>
        <ul>
            <li><a href="#">Perfil</a></li>
            <li><a href="#">Agenda de Remédios</a></li>
            <li><a href="#">Histórico de Agendas</a></li>
            <li><a href="#">Sair</a></li> <!-- Botão Sair -->
        </ul>
    </div>
    <div class="container">
        <h1>Agenda de Remédios</h1>
        <div class="button-container"> <!-- Div para os botões de salvar e baixar -->
            <button class="save-button" onclick="salvarAgenda()">Salvar Agenda</button> <!-- Botão de Salvar Agenda -->
            <button class="download-button" onclick="baixarAgenda()">Baixar Agenda</button> <!-- Botão de Baixar Agenda -->
        </div>
        <div class="agenda" id="agenda"> <!-- Adicionado ID "agenda" -->
            <div class="dia" onclick="abrirModal()">
                <h2>Segunda-feira</h2>
                <span class="data" id="data-segunda"></span>
                <ul id="lista-segunda"></ul>
            </div>
            <div class="dia" onclick="abrirModal()">
                <h2>Terça-feira</h2>
                <span class="data" id="data-terca"></span>
                <ul id="lista-terca"></ul>
            </div>
            <div class="dia" onclick="abrirModal()">
                <h2>Quarta-feira</h2>
                <span class="data" id="data-quarta"></span>
                <ul id="lista-quarta"></ul>
            </div>
            <div class="dia" onclick="abrirModal()">
                <h2>Quinta-feira</h2>
                <span class="data" id="data-quinta"></span>
                <ul id="lista-quinta"></ul>
            </div>
            <div class="dia" onclick="abrirModal()">
                <h2>Sexta-feira</h2>
                <span class="data" id="data-sexta"></span>
                <ul id="lista-sexta"></ul>
            </div>
            <div class="dia" onclick="abrirModal()">
                <h2>Sábado</h2>
                <span class="data" id="data-sabado"></span>
                <ul id="lista-sabado"></ul>
            </div>
            <div class="dia" onclick="abrirModal()">
                <h2>Domingo</h2>
                <span class="data" id="data-domingo"></span>
                <ul id="lista-domingo"></ul>
            </div>
        </div>
    </div>

    <!-- Caixa modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2>Adicionar Remédio</h2> <!-- Removido o dia da semana do título -->
            <div class="checkbox-group">
                <label><input type="checkbox" id="check-segunda"> S</label>
                <label><input type="checkbox" id="check-terca"> T</label>
                <label><input type="checkbox" id="check-quarta"> Q</label>
                <label><input type="checkbox" id="check-quinta"> Q</label>
                <label><input type="checkbox" id="check-sexta"> S</label>
                <label><input type="checkbox" id="check-sabado"> S</label>
                <label><input type="checkbox" id="check-domingo"> D</label>
            </div>
            <form id="form-remedio" onsubmit="adicionarRemedio(event)">
                <input type="text" id="remedio" placeholder="Nome do Remédio" required>
                <input type="time" id="horario" required>
                <input type="file" id="imagem">
                <textarea id="observacoes" placeholder="Observações" rows="4"></textarea>
                <button type="submit">Adicionar Remédio</button>
                <span class="close" onclick="fecharModal()">Fechar</span>
            </form>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf; // Acessa a biblioteca jsPDF

        // Função para gerar as datas da semana
        function gerarDatasDaSemana() {
            const dias = ['segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado', 'domingo'];
            const hoje = new Date(); // Data atual
            const diaDaSemanaAtual = hoje.getDay(); // Dia da semana atual (0 = domingo, 6 = sábado)
            const primeiroDiaSemana = new Date(hoje); 

            // Ajusta para o início da semana (segunda-feira)
            primeiroDiaSemana.setDate(hoje.getDate() - ((diaDaSemanaAtual + 6) % 7));

            dias.forEach((dia, index) => {
                const dataElemento = document.getElementById(`data-${dia}`);
                const dataAtual = new Date(primeiroDiaSemana);
                dataAtual.setDate(primeiroDiaSemana.getDate() + index);
                
                const diaMes = dataAtual.getDate();
                const mes = dataAtual.getMonth() + 1; // Meses começam do 0
                const ano = dataAtual.getFullYear();
                
                dataElemento.textContent = `${diaMes}/${mes}/${ano}`;
            });
        }

        // Função para abrir a modal
        function abrirModal() {
            document.getElementById('modal').style.display = 'flex';
        }

        // Função para fechar a modal
        function fecharModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('form-remedio').reset(); // Limpa o formulário
            document.querySelectorAll('.modal input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false; // Limpa os checkboxes
            });
        }

        // Função para adicionar remédio na lista do dia selecionado
        function adicionarRemedio(event) {
            event.preventDefault(); // Evita o envio do formulário

            const remedio = document.getElementById('remedio').value;
            const horario = document.getElementById('horario').value;
            const observacoes = document.getElementById('observacoes').value;
            const imagem = document.getElementById('imagem').files[0]; // Captura a imagem

            const dias = {
                'check-segunda': 'lista-segunda',
                'check-terca': 'lista-terca',
                'check-quarta': 'lista-quarta',
                'check-quinta': 'lista-quinta',
                'check-sexta': 'lista-sexta',
                'check-sabado': 'lista-sabado',
                'check-domingo': 'lista-domingo'
            };

            for (const [checkboxId, listaId] of Object.entries(dias)) {
                const checkbox = document.getElementById(checkboxId);
                if (checkbox.checked) {
                    const listaElemento = document.getElementById(listaId);
                    const li = document.createElement('li');
                    li.textContent = `${remedio} - ${horario} ${observacoes ? `(${observacoes})` : ''}`;

                    // Se uma imagem foi selecionada, adiciona um link para visualizá-la
                    if (imagem) {
                        const imgUrl = URL.createObjectURL(imagem);
                        const imgLink = document.createElement('a');
                        imgLink.href = imgUrl;
                        imgLink.target = '_blank';
                        imgLink.textContent = ' Ver Imagem'; // Texto do link para visualizar a imagem
                        li.appendChild(imgLink);
                    }
                    
                    listaElemento.appendChild(li);
                }
            }

            fecharModal(); // Fecha a modal após adicionar
        }

        // Função para salvar a agenda (sem implementação específica)
        function salvarAgenda() {
            alert('Agenda salva com sucesso!'); // Mensagem de sucesso, você pode implementar lógica de salvamento real
        }

        // Função para baixar a agenda como PDF
        function baixarAgenda() {
            const agendaElement = document.getElementById('agenda'); // Captura a div da agenda

            html2canvas(agendaElement).then(canvas => {
                const imgData = canvas.toDataURL('image/png'); // Converte a div em imagem
                const doc = new jsPDF();
                doc.addImage(imgData, 'PNG', 10, 10, 190, 0); // Adiciona a imagem ao PDF
                doc.save("agenda_remedios.pdf"); // Salva o PDF com o nome "agenda_remedios.pdf"
            });
        }

        // Chama a função para gerar as datas
        gerarDatasDaSemana();
    </script>
</body>
</html>
